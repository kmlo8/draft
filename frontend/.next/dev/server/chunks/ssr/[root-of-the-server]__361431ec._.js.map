{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///Users/user/Desktop/aaaaaaaaaaa/draft/frontend/lib/api.ts"],"sourcesContent":["import axios from 'axios';\n\nconst API_BASE = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:5001';\n\nexport const api = axios.create({\n    baseURL: API_BASE,\n    withCredentials: true\n});\n\n// ---------------- Access Token Handling ----------------\nlet accessToken: string | null = null;\n\nexport const setAccessToken = (token: string | null) => {\n    accessToken = token;\n    if (token) {\n        api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n    } else {\n        delete api.defaults.headers.common['Authorization'];\n    }\n};\n\n// ================== USER API ==================\nexport const userAPI = {\n    getStats: () => api.get('/api/user/stats'), // new\n    getLikedMovies: () => api.get('/api/user/liked-movies'), // new\n    getLikedActors: () => api.get('/api/user/liked-actors'), // new\n    getLikedDirectors: () => api.get('/api/user/liked-directors'),\n\n    getSearchHistory: (limit = 10) =>\n        api.get('/api/user/search-history', { params: { limit } }),\n\n    submitQuestionnaire: (data: any) =>\n        api.post('/api/user/questionnaire', data),\n\n    getProfile: () => api.get('/api/user/profile'),\n    updateProfile: (data: any) => api.patch('/api/user/profile', data),\n\n};\n\n// ================== MOVIES API ==================\nexport const moviesAPI = {\n    getMovie: async (id: string) => {\n        const { data } = await api.get(`/api/movies/${id}`);\n        return data.movie;\n    },\n\n    getById: (id: string, tmdbId?: number) =>\n        api.get(`/api/movies/${id}`, tmdbId ? { params: { tmdbId } } : {}),\n\n    search: (query: string, filters?: any) =>\n        api.get('/api/movies/search', { params: { q: query, ...filters } }),\n\n    getByGenres: (genres: string[]) =>\n        api.get('/api/movies/by-genres', {\n            params: { genres: genres.join(',') }\n        }),\n\n    getNew: (limit?: number) =>\n        api.get('/api/movies/new', { params: limit ? { limit } : {} }),\n\n    getPopular: (limit?: number) =>\n        api.get('/api/movies/popular', { params: limit ? { limit } : {} }),\n\n    trackClick: (id: string) => api.post(`/api/movies/${id}/click`)\n};\n\n// ================== LIKES API ==================\nexport const likesAPI = {\n    create: (targetType: string, targetId: string) =>\n        api.post('/api/likes', { targetType, targetId }),\n\n    delete: (likeId: string) => api.delete(`/api/likes/${likeId}`),\n\n    deleteByTarget: (targetType: string, targetId: string) =>\n        api.delete('/api/likes', { params: { targetType, targetId } }),\n\n    check: (items: { type: string; id: string }[]) =>\n        api.get('/api/likes/check', {\n            params: { items: JSON.stringify(items) }\n        }),\n\n    toggle: (targetType: string, targetId: string) =>\n        api.post('/api/likes/toggle', { targetType, targetId })\n};\n\n// ================== ACTORS API ==================\nexport const actorsAPI = {\n    getById: (id: string) => api.get(`/api/actors/${id}`),\n    search: (q: string) => api.get('/api/actors/search', { params: { q } })\n};\n\n// ================== DIRECTORS API ==================\nexport const directorsAPI = {\n    getById: async (id: string) => {\n        const { data } = await api.get(`/api/directors/${id}`);\n        return data.director;\n    },\n    search: (q: string) => api.get('/api/directors/search', { params: { q } })\n};\n\n// ================== RECOMMENDATIONS API ==================\nexport const recommendationsAPI = {\n    search: (query: string, userPreferences?: any) =>\n        api.post('/api/recommendations/search', {\n            query,\n            userPreferences\n        })\n};\n// ================== AUTH API ==================\nexport const authAPI = {\n    login: (email: string, password: string) =>\n        api.post('/api/auth/login', { email, password }),\n\n    logout: () =>\n        api.post('/api/auth/logout'),\n\n    refresh: () =>\n        api.post('/api/auth/refresh')\n};"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;;AAEA,MAAM,WAAW,6DAAmC;AAE7C,MAAM,MAAM,+LAAK,CAAC,MAAM,CAAC;IAC5B,SAAS;IACT,iBAAiB;AACrB;AAEA,0DAA0D;AAC1D,IAAI,cAA6B;AAE1B,MAAM,iBAAiB,CAAC;IAC3B,cAAc;IACd,IAAI,OAAO;QACP,IAAI,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,gBAAgB,GAAG,CAAC,OAAO,EAAE,OAAO;IACpE,OAAO;QACH,OAAO,IAAI,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,gBAAgB;IACvD;AACJ;AAGO,MAAM,UAAU;IACnB,UAAU,IAAM,IAAI,GAAG,CAAC;IACxB,gBAAgB,IAAM,IAAI,GAAG,CAAC;IAC9B,gBAAgB,IAAM,IAAI,GAAG,CAAC;IAC9B,mBAAmB,IAAM,IAAI,GAAG,CAAC;IAEjC,kBAAkB,CAAC,QAAQ,EAAE,GACzB,IAAI,GAAG,CAAC,4BAA4B;YAAE,QAAQ;gBAAE;YAAM;QAAE;IAE5D,qBAAqB,CAAC,OAClB,IAAI,IAAI,CAAC,2BAA2B;IAExC,YAAY,IAAM,IAAI,GAAG,CAAC;IAC1B,eAAe,CAAC,OAAc,IAAI,KAAK,CAAC,qBAAqB;AAEjE;AAGO,MAAM,YAAY;IACrB,UAAU,OAAO;QACb,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,IAAI,GAAG,CAAC,CAAC,YAAY,EAAE,IAAI;QAClD,OAAO,KAAK,KAAK;IACrB;IAEA,SAAS,CAAC,IAAY,SAClB,IAAI,GAAG,CAAC,CAAC,YAAY,EAAE,IAAI,EAAE,SAAS;YAAE,QAAQ;gBAAE;YAAO;QAAE,IAAI,CAAC;IAEpE,QAAQ,CAAC,OAAe,UACpB,IAAI,GAAG,CAAC,sBAAsB;YAAE,QAAQ;gBAAE,GAAG;gBAAO,GAAG,OAAO;YAAC;QAAE;IAErE,aAAa,CAAC,SACV,IAAI,GAAG,CAAC,yBAAyB;YAC7B,QAAQ;gBAAE,QAAQ,OAAO,IAAI,CAAC;YAAK;QACvC;IAEJ,QAAQ,CAAC,QACL,IAAI,GAAG,CAAC,mBAAmB;YAAE,QAAQ,QAAQ;gBAAE;YAAM,IAAI,CAAC;QAAE;IAEhE,YAAY,CAAC,QACT,IAAI,GAAG,CAAC,uBAAuB;YAAE,QAAQ,QAAQ;gBAAE;YAAM,IAAI,CAAC;QAAE;IAEpE,YAAY,CAAC,KAAe,IAAI,IAAI,CAAC,CAAC,YAAY,EAAE,GAAG,MAAM,CAAC;AAClE;AAGO,MAAM,WAAW;IACpB,QAAQ,CAAC,YAAoB,WACzB,IAAI,IAAI,CAAC,cAAc;YAAE;YAAY;QAAS;IAElD,QAAQ,CAAC,SAAmB,IAAI,MAAM,CAAC,CAAC,WAAW,EAAE,QAAQ;IAE7D,gBAAgB,CAAC,YAAoB,WACjC,IAAI,MAAM,CAAC,cAAc;YAAE,QAAQ;gBAAE;gBAAY;YAAS;QAAE;IAEhE,OAAO,CAAC,QACJ,IAAI,GAAG,CAAC,oBAAoB;YACxB,QAAQ;gBAAE,OAAO,KAAK,SAAS,CAAC;YAAO;QAC3C;IAEJ,QAAQ,CAAC,YAAoB,WACzB,IAAI,IAAI,CAAC,qBAAqB;YAAE;YAAY;QAAS;AAC7D;AAGO,MAAM,YAAY;IACrB,SAAS,CAAC,KAAe,IAAI,GAAG,CAAC,CAAC,YAAY,EAAE,IAAI;IACpD,QAAQ,CAAC,IAAc,IAAI,GAAG,CAAC,sBAAsB;YAAE,QAAQ;gBAAE;YAAE;QAAE;AACzE;AAGO,MAAM,eAAe;IACxB,SAAS,OAAO;QACZ,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,IAAI,GAAG,CAAC,CAAC,eAAe,EAAE,IAAI;QACrD,OAAO,KAAK,QAAQ;IACxB;IACA,QAAQ,CAAC,IAAc,IAAI,GAAG,CAAC,yBAAyB;YAAE,QAAQ;gBAAE;YAAE;QAAE;AAC5E;AAGO,MAAM,qBAAqB;IAC9B,QAAQ,CAAC,OAAe,kBACpB,IAAI,IAAI,CAAC,+BAA+B;YACpC;YACA;QACJ;AACR;AAEO,MAAM,UAAU;IACnB,OAAO,CAAC,OAAe,WACnB,IAAI,IAAI,CAAC,mBAAmB;YAAE;YAAO;QAAS;IAElD,QAAQ,IACJ,IAAI,IAAI,CAAC;IAEb,SAAS,IACL,IAAI,IAAI,CAAC;AACjB","debugId":null}},
    {"offset": {"line": 237, "column": 0}, "map": {"version":3,"sources":["file:///Users/user/Desktop/aaaaaaaaaaa/draft/frontend/context/AuthContext.tsx"],"sourcesContent":["'use client';\n\nimport React, { createContext, useContext, useState, useEffect, ReactNode, useCallback } from 'react';\nimport { setAccessToken as setApiAccessToken, userAPI } from '@/lib/api';\n\ninterface User {\n  id: string;\n  email: string;\n  darkMode: boolean;\n  preferredGenres?: string[];\n  preferredActors?: string[];\n  preferredDirectors?: string[];\n}\n\ninterface AuthContextType {\n  user: User | null;\n  isAuthenticated: boolean;\n  login: (token: string, userData: User) => void;\n  logout: () => void;\n  updateUser: (userData: Partial<User>) => Promise<void>;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport const AuthProvider = ({ children }: { children: ReactNode }) => {\n  const [user, setUser] = useState<User | null>(null);\n  const [accessToken, setAccessToken] = useState<string | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  const isAuthenticated = !!accessToken;\n\n  const logout = useCallback(async () => {\n    try {\n      await fetch(`${process.env.NEXT_PUBLIC_API_URL}/api/auth/logout`, {\n        method: 'POST',\n        credentials: 'include',\n        headers: { 'Authorization': `Bearer ${accessToken}` }\n      });\n    } catch (error) {\n      console.error('Logout error:', error);\n    } finally {\n      setAccessToken(null);\n      setApiAccessToken(null);\n      setUser(null); // Explicitly clear user state\n    }\n  }, [accessToken]);\n\n  useEffect(() => {\n    const refreshToken = async () => {\n      try {\n        const response = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/api/auth/refresh`, {\n          method: 'POST',\n          credentials: 'include'\n        });\n\n        if (response.ok) {\n          const data = await response.json();\n          setAccessToken(data.accessToken);\n          setApiAccessToken(data.accessToken);\n        }\n      } catch (error) {\n        console.error('Initial refresh failed:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    void refreshToken();\n  }, []);\n\n  useEffect(() => {\n    const fetchProfile = async () => {\n      if (isAuthenticated) {\n        try {\n          const response = await userAPI.getProfile();\n          setUser(response.data.user);\n          console.log('User data loaded:', response.data.user);\n        } catch (error) {\n          console.error('Failed to fetch profile, logging out:', error);\n          void logout();\n        }\n      }\n    };\n    void fetchProfile();\n  }, [isAuthenticated, logout]);\n\n  const login = (token: string, userData: User) => {\n    setAccessToken(token);\n    setApiAccessToken(token);\n    setUser(userData);\n    console.log('User logged in:', userData);\n  };\n\n  const updateUser = async (userData: Partial<User>) => {\n    if (!user) return;\n\n    const oldUser = user;\n    // Correctly merge the new data with the existing user object\n    const updatedUser = { ...oldUser, ...userData };\n    setUser(updatedUser);\n\n    try {\n      const response = await userAPI.updateProfile(userData);\n      setUser(response.data.user);\n      console.log('User data saved and updated:', response.data.user);\n    } catch (error) {\n      console.error('Failed to update user data:', error);\n      setUser(oldUser); // Revert on error\n    }\n  };\n\n  return (\n    <AuthContext.Provider\n      value={{\n        user,\n        isAuthenticated,\n        login,\n        logout,\n        updateUser\n      }}\n    >\n      {!isLoading && children}\n    </AuthContext.Provider>\n  );\n};\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AAHA;;;;AAsBA,MAAM,4BAAc,IAAA,qQAAa,EAA8B;AAExD,MAAM,eAAe,CAAC,EAAE,QAAQ,EAA2B;IAChE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,gQAAQ,EAAc;IAC9C,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,gQAAQ,EAAgB;IAC9D,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,gQAAQ,EAAC;IAE3C,MAAM,kBAAkB,CAAC,CAAC;IAE1B,MAAM,SAAS,IAAA,mQAAW,EAAC;QACzB,IAAI;YACF,MAAM,MAAM,6DAAmC,gBAAgB,CAAC,EAAE;gBAChE,QAAQ;gBACR,aAAa;gBACb,SAAS;oBAAE,iBAAiB,CAAC,OAAO,EAAE,aAAa;gBAAC;YACtD;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,iBAAiB;QACjC,SAAU;YACR,eAAe;YACf,IAAA,2KAAiB,EAAC;YAClB,QAAQ,OAAO,8BAA8B;QAC/C;IACF,GAAG;QAAC;KAAY;IAEhB,IAAA,iQAAS,EAAC;QACR,MAAM,eAAe;YACnB,IAAI;gBACF,MAAM,WAAW,MAAM,MAAM,6DAAmC,iBAAiB,CAAC,EAAE;oBAClF,QAAQ;oBACR,aAAa;gBACf;gBAEA,IAAI,SAAS,EAAE,EAAE;oBACf,MAAM,OAAO,MAAM,SAAS,IAAI;oBAChC,eAAe,KAAK,WAAW;oBAC/B,IAAA,2KAAiB,EAAC,KAAK,WAAW;gBACpC;YACF,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,2BAA2B;YAC3C,SAAU;gBACR,aAAa;YACf;QACF;QACA,KAAK;IACP,GAAG,EAAE;IAEL,IAAA,iQAAS,EAAC;QACR,MAAM,eAAe;YACnB,IAAI,iBAAiB;gBACnB,IAAI;oBACF,MAAM,WAAW,MAAM,oKAAO,CAAC,UAAU;oBACzC,QAAQ,SAAS,IAAI,CAAC,IAAI;oBAC1B,QAAQ,GAAG,CAAC,qBAAqB,SAAS,IAAI,CAAC,IAAI;gBACrD,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,yCAAyC;oBACvD,KAAK;gBACP;YACF;QACF;QACA,KAAK;IACP,GAAG;QAAC;QAAiB;KAAO;IAE5B,MAAM,QAAQ,CAAC,OAAe;QAC5B,eAAe;QACf,IAAA,2KAAiB,EAAC;QAClB,QAAQ;QACR,QAAQ,GAAG,CAAC,mBAAmB;IACjC;IAEA,MAAM,aAAa,OAAO;QACxB,IAAI,CAAC,MAAM;QAEX,MAAM,UAAU;QAChB,6DAA6D;QAC7D,MAAM,cAAc;YAAE,GAAG,OAAO;YAAE,GAAG,QAAQ;QAAC;QAC9C,QAAQ;QAER,IAAI;YACF,MAAM,WAAW,MAAM,oKAAO,CAAC,aAAa,CAAC;YAC7C,QAAQ,SAAS,IAAI,CAAC,IAAI;YAC1B,QAAQ,GAAG,CAAC,gCAAgC,SAAS,IAAI,CAAC,IAAI;QAChE,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,+BAA+B;YAC7C,QAAQ,UAAU,kBAAkB;QACtC;IACF;IAEA,qBACE,6RAAC,YAAY,QAAQ;QACnB,OAAO;YACL;YACA;YACA;YACA;YACA;QACF;kBAEC,CAAC,aAAa;;;;;;AAGrB;AAEO,MAAM,UAAU;IACrB,MAAM,UAAU,IAAA,kQAAU,EAAC;IAC3B,IAAI,YAAY,WAAW;QACzB,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 363, "column": 0}, "map": {"version":3,"sources":["file:///Users/user/Desktop/aaaaaaaaaaa/draft/frontend/context/ThemeContext.tsx"],"sourcesContent":["'use client';\n\nimport React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\nimport { useAuth } from './AuthContext';\n\ninterface ThemeContextType {\n  darkMode: boolean;\n  toggleDarkMode: () => void;\n}\n\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\n\nexport const ThemeProvider = ({ children }: { children: ReactNode }) => {\n  const { user, accessToken } = useAuth();\n  const [darkMode, setDarkMode] = useState(true); // Default to dark mode\n\n  // Sync with user preferences\n  useEffect(() => {\n    if (user && user.darkMode !== undefined) {\n      setDarkMode(user.darkMode);\n    }\n  }, [user]);\n\n  // Apply theme classes to html element\n  useEffect(() => {\n    const el = document.documentElement;\n    if (darkMode) {\n      el.classList.add('dark');\n      el.classList.remove('light');\n    } else {\n      el.classList.remove('dark');\n      el.classList.add('light');\n    }\n  }, [darkMode]);\n\n  const toggleDarkMode = async () => {\n    const newDarkMode = !darkMode;\n    setDarkMode(newDarkMode);\n\n    // Update on server if authenticated\n    if (accessToken) {\n      try {\n        await fetch(`${process.env.NEXT_PUBLIC_API_URL}/api/user/profile`, {\n          method: 'PATCH',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${accessToken}`\n          },\n          credentials: 'include',\n          body: JSON.stringify({ darkMode: newDarkMode })\n        });\n      } catch (error) {\n        console.error('Failed to update dark mode preference:', error);\n      }\n    }\n  };\n\n  return (\n    <ThemeContext.Provider value={{ darkMode, toggleDarkMode }}>\n      {children}\n    </ThemeContext.Provider>\n  );\n};\n\nexport const useTheme = () => {\n  const context = useContext(ThemeContext);\n  if (context === undefined) {\n    throw new Error('useTheme must be used within a ThemeProvider');\n  }\n  return context;\n};\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AAHA;;;;AAUA,MAAM,6BAAe,IAAA,qQAAa,EAA+B;AAE1D,MAAM,gBAAgB,CAAC,EAAE,QAAQ,EAA2B;IACjE,MAAM,EAAE,IAAI,EAAE,WAAW,EAAE,GAAG,IAAA,iLAAO;IACrC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,gQAAQ,EAAC,OAAO,uBAAuB;IAEvE,6BAA6B;IAC7B,IAAA,iQAAS,EAAC;QACR,IAAI,QAAQ,KAAK,QAAQ,KAAK,WAAW;YACvC,YAAY,KAAK,QAAQ;QAC3B;IACF,GAAG;QAAC;KAAK;IAET,sCAAsC;IACtC,IAAA,iQAAS,EAAC;QACR,MAAM,KAAK,SAAS,eAAe;QACnC,IAAI,UAAU;YACZ,GAAG,SAAS,CAAC,GAAG,CAAC;YACjB,GAAG,SAAS,CAAC,MAAM,CAAC;QACtB,OAAO;YACL,GAAG,SAAS,CAAC,MAAM,CAAC;YACpB,GAAG,SAAS,CAAC,GAAG,CAAC;QACnB;IACF,GAAG;QAAC;KAAS;IAEb,MAAM,iBAAiB;QACrB,MAAM,cAAc,CAAC;QACrB,YAAY;QAEZ,oCAAoC;QACpC,IAAI,aAAa;YACf,IAAI;gBACF,MAAM,MAAM,6DAAmC,iBAAiB,CAAC,EAAE;oBACjE,QAAQ;oBACR,SAAS;wBACP,gBAAgB;wBAChB,iBAAiB,CAAC,OAAO,EAAE,aAAa;oBAC1C;oBACA,aAAa;oBACb,MAAM,KAAK,SAAS,CAAC;wBAAE,UAAU;oBAAY;gBAC/C;YACF,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,0CAA0C;YAC1D;QACF;IACF;IAEA,qBACE,6RAAC,aAAa,QAAQ;QAAC,OAAO;YAAE;YAAU;QAAe;kBACtD;;;;;;AAGP;AAEO,MAAM,WAAW;IACtB,MAAM,UAAU,IAAA,kQAAU,EAAC;IAC3B,IAAI,YAAY,WAAW;QACzB,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT","debugId":null}}]
}